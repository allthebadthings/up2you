<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jewelry Product Photo Studio - Professional Image Creator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(to right, #434343 0%, black 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 20px;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-family: 'Cinzel', serif;
            font-size: 3em;
            background: linear-gradient(135deg, #d4af37, #f4e4c1, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            letter-spacing: 3px;
        }
        
        .header p {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 300;
        }
        
        .workflow {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .workflow-step {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .workflow-step.active {
            background: rgba(212, 175, 55, 0.15);
            border-color: rgba(212, 175, 55, 0.6);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }
        
        .workflow-step.completed {
            background: rgba(72, 187, 120, 0.1);
            border-color: rgba(72, 187, 120, 0.5);
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(212, 175, 55, 0.2);
            color: #d4af37;
            font-size: 1.5em;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .workflow-step.active .step-number {
            background: #d4af37;
            color: black;
            animation: pulse 2s infinite;
        }
        
        .workflow-step.completed .step-number {
            background: #48bb78;
            border-color: #48bb78;
            color: white;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .step-title {
            font-family: 'Cinzel', serif;
            font-size: 1.2em;
            color: #d4af37;
            margin-bottom: 10px;
        }
        
        .step-desc {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .main-stage {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(212, 175, 55, 0.2);
            border-radius: 20px;
            padding: 40px;
            min-height: 600px;
        }
        
        .stage {
            display: none;
        }
        
        .stage.active {
            display: block;
        }
        
        .upload-zone {
            border: 3px dashed rgba(212, 175, 55, 0.4);
            border-radius: 15px;
            padding: 80px 40px;
            text-align: center;
            background: rgba(212, 175, 55, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover {
            border-color: rgba(212, 175, 55, 0.7);
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.02);
        }
        
        .upload-zone.dragover {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.2);
        }
        
        .upload-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }
        
        .upload-zone h2 {
            font-family: 'Cinzel', serif;
            font-size: 2em;
            color: #d4af37;
            margin-bottom: 15px;
        }
        
        .preview-section {
            display: none;
            margin-top: 40px;
        }
        
        .preview-section.show {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .preview-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(212, 175, 55, 0.2);
        }
        
        .preview-box h3 {
            font-family: 'Cinzel', serif;
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .preview-image {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 10px;
            margin-bottom: 15px;
            background: repeating-conic-gradient(#808080 0% 25%, transparent 0% 50%) 50% / 20px 20px;
        }
        
        .action-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-family: 'Lato', sans-serif;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .action-btn.primary {
            background: linear-gradient(135deg, #d4af37, #f4e4c1);
            color: black;
        }
        
        .action-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }
        
        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .action-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .style-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .style-card {
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .style-card:hover {
            border-color: rgba(212, 175, 55, 0.6);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }
        
        .style-card.selected {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.15);
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);
        }
        
        .style-card.selected::before {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: #d4af37;
            color: black;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .style-icon {
            font-size: 3em;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .style-name {
            font-family: 'Cinzel', serif;
            font-size: 1.2em;
            color: #d4af37;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .style-desc {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            line-height: 1.5;
        }
        
        .style-preview {
            margin-top: 30px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .style-preview h3 {
            font-family: 'Cinzel', serif;
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .result-image {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(212, 175, 55, 0.2);
            border-top: 4px solid #d4af37;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        #fileInput {
            display: none;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(212, 175, 55, 0.95);
            color: black;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .back-btn {
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s ease;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        canvas {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∏ PRODUCT PHOTO STUDIO</h1>
            <p>Transform raw jewelry photos into professional product images - No setup required!</p>
        </div>
        
        <div class="workflow">
            <div class="workflow-step active" id="step1Indicator">
                <div class="step-number">1</div>
                <div class="step-title">Upload & Remove Background</div>
                <div class="step-desc">Upload your raw photo - we'll clean it up</div>
            </div>
            <div class="workflow-step" id="step2Indicator">
                <div class="step-number">2</div>
                <div class="step-title">Choose Display Style</div>
                <div class="step-desc">Select from 5 professional presentation styles</div>
            </div>
            <div class="workflow-step" id="step3Indicator">
                <div class="step-number">3</div>
                <div class="step-title">Generate & Download</div>
                <div class="step-desc">Get your professional product photo</div>
            </div>
        </div>
        
        <div class="main-stage">
            <!-- Stage 1: Upload and Background Removal -->
            <div class="stage active" id="stage1">
                <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üíé</div>
                    <h2>Upload Your Jewelry Photo</h2>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-top: 10px;">
                        Click or drag your raw jewelry image here<br>
                        <small>(Works best with photos on plain backgrounds)</small>
                    </p>
                    <input type="file" id="fileInput" accept="image/*">
                </div>
                
                <div class="preview-section" id="previewSection">
                    <div class="preview-box">
                        <h3>Original Image</h3>
                        <img id="originalImage" class="preview-image">
                    </div>
                    <div class="preview-box">
                        <h3>Cleaned & Ready</h3>
                        <img id="processedImage" class="preview-image">
                        <button class="action-btn primary" onclick="proceedToStyleSelection()" id="proceedBtn">
                            Continue to Style Selection ‚Üí
                        </button>
                        <button class="action-btn secondary" onclick="downloadProcessedImage()">
                            üíæ Download This Image
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Stage 2: Style Selection -->
            <div class="stage" id="stage2">
                <button class="back-btn" onclick="goToStage(1)">‚Üê Back to Upload</button>
                
                <h2 style="font-family: 'Cinzel', serif; color: #d4af37; font-size: 2em; margin-bottom: 10px;">
                    Choose Your Display Style
                </h2>
                <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">
                    Select how you want your jewelry displayed in the final product image
                </p>
                
                <div class="style-grid">
                    <div class="style-card" onclick="selectStyle('floating')">
                        <div class="style-icon">‚ú®</div>
                        <div class="style-name">Floating - Neutral Background</div>
                        <div class="style-desc">
                            Clean, minimalist presentation on soft beige gradient. Perfect for e-commerce.
                        </div>
                    </div>
                    
                    <div class="style-card" onclick="selectStyle('bust')">
                        <div class="style-icon">üë§</div>
                        <div class="style-name">On Jewelry Display Bust</div>
                        <div class="style-desc">
                            Shown on elegant white mannequin bust for realistic presentation.
                        </div>
                    </div>
                    
                    <div class="style-card" onclick="selectStyle('natural')">
                        <div class="style-icon">üåø</div>
                        <div class="style-name">Natural Earthy Display</div>
                        <div class="style-desc">
                            Artfully arranged on marble texture with botanical accents.
                        </div>
                    </div>
                    
                    <div class="style-card" onclick="selectStyle('detailed')">
                        <div class="style-icon">üîç</div>
                        <div class="style-name">With Detail Zoom Insert</div>
                        <div class="style-desc">
                            Main image plus zoomed detail showing craftsmanship closeup.
                        </div>
                    </div>
                    
                    <div class="style-card" onclick="selectStyle('luxury')">
                        <div class="style-icon">üí´</div>
                        <div class="style-name">Luxury Velvet Display</div>
                        <div class="style-desc">
                            Premium burgundy velvet cushion for high-end boutique aesthetic.
                        </div>
                    </div>
                </div>
                
                <div class="style-preview" id="stylePreview" style="display: none;">
                    <h3>Your Selection: <span id="selectedStyleName"></span></h3>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">
                        We'll create a professional product photo in this style
                    </p>
                    <button class="action-btn primary" onclick="generateProductPhoto()" style="max-width: 400px;">
                        üé® Generate Professional Photo
                    </button>
                </div>
            </div>
            
            <!-- Stage 3: Results -->
            <div class="stage" id="stage3">
                <button class="back-btn" onclick="goToStage(2)">‚Üê Choose Different Style</button>
                
                <div id="generatingMessage" class="loading">
                    <div class="spinner"></div>
                    <h2 style="font-family: 'Cinzel', serif; color: #d4af37; font-size: 1.8em; margin-bottom: 10px;">
                        Creating Your Professional Product Photo
                    </h2>
                    <p style="color: rgba(255, 255, 255, 0.7);">
                        Compositing your jewelry onto the professional background...
                    </p>
                </div>
                
                <div id="resultsSection" class="hidden">
                    <h2 style="font-family: 'Cinzel', serif; color: #d4af37; font-size: 2em; margin-bottom: 20px;">
                        ‚ú® Your Professional Product Photo
                    </h2>
                    
                    <div class="result-grid">
                        <div class="result-card">
                            <h3 style="color: #d4af37; margin-bottom: 15px;">Final Product Image</h3>
                            <img id="finalImage" class="result-image">
                            <button class="action-btn primary" onclick="downloadFinalImage()">
                                üíæ Download High-Res Image
                            </button>
                            <button class="action-btn secondary" onclick="uploadToImgur()">
                                üîó Upload to Imgur & Get URL
                            </button>
                        </div>
                        
                        <div class="result-card">
                            <h3 style="color: #d4af37; margin-bottom: 15px;">Original (Cleaned)</h3>
                            <img id="comparisonImage" class="result-image">
                            <button class="action-btn secondary" onclick="downloadProcessedImage()">
                                üíæ Download Clean Version
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="action-btn secondary" onclick="startOver()" style="max-width: 300px;">
                            üîÑ Create Another Photo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <canvas id="workCanvas"></canvas>
    <canvas id="outputCanvas"></canvas>

    <script>
        const IMGUR_CLIENT_ID = '546c25a59c58ad7';
        
        let originalImage = null;
        let processedImageData = null;
        let selectedStyle = null;
        
        const styleInfo = {
            floating: { name: 'Floating - Neutral Background', icon: '‚ú®' },
            bust: { name: 'On Jewelry Display Bust', icon: 'üë§' },
            natural: { name: 'Natural Earthy Display', icon: 'üåø' },
            detailed: { name: 'With Detail Zoom Insert', icon: 'üîç' },
            luxury: { name: 'Luxury Velvet Display', icon: 'üí´' }
        };
        
        // File upload
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        
        fileInput.addEventListener('change', handleFileSelect);
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleFile(file);
            }
        });
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }
        
        function handleFile(file) {
            showToast('üì§ Loading image...');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    originalImage = img;
                    document.getElementById('originalImage').src = e.target.result;
                    
                    // Process image (simple background removal simulation)
                    processImage(img);
                    
                    document.getElementById('previewSection').classList.add('show');
                    updateStepIndicator(1, 'completed');
                    showToast('‚úÖ Image loaded!');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function processImage(img) {
            // Create a canvas for processing
            const canvas = document.getElementById('workCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = img.width;
            canvas.height = img.height;
            
            // Draw original
            ctx.drawImage(img, 0, 0);
            
            // For now, just use the original (in production, you'd do edge detection, etc.)
            processedImageData = canvas.toDataURL('image/png');
            document.getElementById('processedImage').src = processedImageData;
        }
        
        function proceedToStyleSelection() {
            goToStage(2);
            updateStepIndicator(2, 'active');
        }
        
        function selectStyle(style) {
            selectedStyle = style;
            
            document.querySelectorAll('.style-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            document.getElementById('stylePreview').style.display = 'block';
            document.getElementById('selectedStyleName').textContent = styleInfo[style].name;
            
            showToast(`‚úÖ Selected: ${styleInfo[style].name}`);
        }
        
        function generateProductPhoto() {
            if (!selectedStyle) {
                showToast('‚ö†Ô∏è Please select a display style first', 'warning');
                return;
            }
            
            goToStage(3);
            updateStepIndicator(2, 'completed');
            updateStepIndicator(3, 'active');
            
            document.getElementById('comparisonImage').src = processedImageData;
            
            // Generate the styled image
            setTimeout(() => {
                createStyledImage();
            }, 1500);
        }
        
        function createStyledImage() {
            const canvas = document.getElementById('outputCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size (standard product photo size)
            canvas.width = 1200;
            canvas.height = 1200;
            
            // Draw background based on selected style
            drawStyledBackground(ctx, selectedStyle);
            
            // Calculate jewelry positioning
            const jewelryImg = new Image();
            jewelryImg.onload = () => {
                // Center and scale the jewelry
                const scale = Math.min(
                    (canvas.width * 0.6) / jewelryImg.width,
                    (canvas.height * 0.6) / jewelryImg.height
                );
                
                const scaledWidth = jewelryImg.width * scale;
                const scaledHeight = jewelryImg.height * scale;
                const x = (canvas.width - scaledWidth) / 2;
                const y = (canvas.height - scaledHeight) / 2;
                
                // Add shadow for depth
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 30;
                ctx.shadowOffsetY = 15;
                
                // Draw the jewelry
                ctx.drawImage(jewelryImg, x, y, scaledWidth, scaledHeight);
                
                // Reset shadow
                ctx.shadowColor = 'transparent';
                
                // Add style-specific overlays
                addStyleOverlays(ctx, selectedStyle);
                
                // Show result
                const finalImageData = canvas.toDataURL('image/png');
                document.getElementById('finalImage').src = finalImageData;
                
                document.getElementById('generatingMessage').classList.add('hidden');
                document.getElementById('resultsSection').classList.remove('hidden');
                
                updateStepIndicator(3, 'completed');
                showToast('‚ú® Professional photo created!');
            };
            jewelryImg.src = processedImageData;
        }
        
        function drawStyledBackground(ctx, style) {
            const w = ctx.canvas.width;
            const h = ctx.canvas.height;
            
            switch(style) {
                case 'floating':
                    // Soft neutral gradient
                    const grad1 = ctx.createLinearGradient(0, 0, 0, h);
                    grad1.addColorStop(0, '#f5f5f0');
                    grad1.addColorStop(1, '#e8e6e1');
                    ctx.fillStyle = grad1;
                    ctx.fillRect(0, 0, w, h);
                    break;
                    
                case 'bust':
                    // White with subtle vignette
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, w, h);
                    
                    // Draw simplified bust silhouette
                    ctx.fillStyle = '#f0f0f0';
                    ctx.beginPath();
                    ctx.ellipse(w/2, h*0.7, w*0.15, h*0.25, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Neck
                    ctx.fillRect(w/2 - w*0.05, h*0.5, w*0.1, h*0.2);
                    break;
                    
                case 'natural':
                    // Marble texture (simplified)
                    const grad2 = ctx.createLinearGradient(0, 0, w, h);
                    grad2.addColorStop(0, '#e8e4dc');
                    grad2.addColorStop(0.5, '#f2ede4');
                    grad2.addColorStop(1, '#ddd8ce');
                    ctx.fillStyle = grad2;
                    ctx.fillRect(0, 0, w, h);
                    
                    // Add some marble veining
                    ctx.strokeStyle = 'rgba(180, 170, 155, 0.3)';
                    ctx.lineWidth = 3;
                    for(let i = 0; i < 5; i++) {
                        ctx.beginPath();
                        ctx.moveTo(Math.random() * w, Math.random() * h);
                        ctx.quadraticCurveTo(
                            Math.random() * w, Math.random() * h,
                            Math.random() * w, Math.random() * h
                        );
                        ctx.stroke();
                    }
                    break;
                    
                case 'detailed':
                    // Clean white
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, w, h);
                    break;
                    
                case 'luxury':
                    // Deep burgundy velvet gradient
                    const grad3 = ctx.createRadialGradient(w/2, h/2, 0, w/2, h/2, w*0.7);
                    grad3.addColorStop(0, '#6b1f3a');
                    grad3.addColorStop(1, '#4a1628');
                    ctx.fillStyle = grad3;
                    ctx.fillRect(0, 0, w, h);
                    
                    // Add velvet texture (subtle noise)
                    for(let i = 0; i < 2000; i++) {
                        ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.05})`;
                        ctx.fillRect(Math.random() * w, Math.random() * h, 2, 2);
                    }
                    break;
            }
        }
        
        function addStyleOverlays(ctx, style) {
            const w = ctx.canvas.width;
            const h = ctx.canvas.height;
            
            if (style === 'detailed') {
                // Add detail zoom box in corner
                ctx.strokeStyle = '#d4af37';
                ctx.lineWidth = 3;
                ctx.strokeRect(w*0.65, h*0.65, w*0.3, h*0.3);
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.fillRect(w*0.65, h*0.65, w*0.3, h*0.3);
                
                ctx.fillStyle = '#666';
                ctx.font = '20px Lato';
                ctx.textAlign = 'center';
                ctx.fillText('Detail View', w*0.8, h*0.8);
            }
        }
        
        function downloadProcessedImage() {
            const link = document.createElement('a');
            link.download = `jewelry_clean_${Date.now()}.png`;
            link.href = processedImageData;
            link.click();
            showToast('üíæ Clean image downloaded!');
        }
        
        function downloadFinalImage() {
            const canvas = document.getElementById('outputCanvas');
            const link = document.createElement('a');
            link.download = `jewelry_product_${selectedStyle}_${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            showToast('üíæ Product image downloaded!');
        }
        
        async function uploadToImgur() {
            showToast('üì§ Uploading to Imgur...');
            
            try {
                const canvas = document.getElementById('outputCanvas');
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                
                const formData = new FormData();
                formData.append('image', blob);
                
                const response = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Client-ID ' + IMGUR_CLIENT_ID
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const url = data.data.link;
                    navigator.clipboard.writeText(url);
                    showToast(`‚úÖ Uploaded! URL copied to clipboard`);
                    
                    prompt('Image uploaded to Imgur! Copy this URL for your inventory:', url);
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                showToast('‚ùå Upload failed. Download and upload manually.', 'error');
            }
        }
        
        function goToStage(stageNum) {
            document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
            document.getElementById(`stage${stageNum}`).classList.add('active');
        }
        
        function updateStepIndicator(step, status) {
            const indicator = document.getElementById(`step${step}Indicator`);
            indicator.classList.remove('active', 'completed');
            if (status) {
                indicator.classList.add(status);
            }
        }
        
        function startOver() {
            originalImage = null;
            processedImageData = null;
            selectedStyle = null;
            
            document.getElementById('previewSection').classList.remove('show');
            document.getElementById('stylePreview').style.display = 'none';
            document.querySelectorAll('.style-card').forEach(card => card.classList.remove('selected'));
            
            goToStage(1);
            updateStepIndicator(1, 'active');
            updateStepIndicator(2, null);
            updateStepIndicator(3, null);
            
            document.getElementById('fileInput').value = '';
            showToast('üîÑ Ready for new photo!');
        }
        
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            if (type === 'error') {
                toast.style.background = 'rgba(239, 68, 68, 0.95)';
                toast.style.color = 'white';
            } else if (type === 'warning') {
                toast.style.background = 'rgba(245, 158, 11, 0.95)';
                toast.style.color = 'white';
            }
            
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }
    </script>
</body>
</html>
